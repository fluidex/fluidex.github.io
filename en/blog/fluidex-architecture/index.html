<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9a5d2afd2dfd940cbcc7.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#e3eaf2;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#3c526d}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#111b27}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;white-space:normal;color:#333;background:silver}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8da1b9}.token.punctuation{color:#e3eaf2}.token.delimiter.important,.token.selector .parent,.token.tag,.token.tag .token.punctuation{color:#6cc}.token.attr-name,.token.boolean,.token.boolean.important,.token.constant,.token.number,.token.selector .token.attribute{color:#e6d37a}.token.class-name,.token.key,.token.parameter,.token.property,.token.property-access,.token.variable{color:#6cb8e6}.token.attr-value,.token.color,.token.inserted,.token.selector .token.value,.token.string,.token.string .token.url-link{color:#91d076}.token.builtin,.token.keyword-array,.token.package,.token.regex{color:#f4adf4}.token.function,.token.selector .token.class,.token.selector .token.id{color:#c699e3}.token.atrule .token.rule,.token.combinator,.token.keyword,.token.operator,.token.pseudo-class,.token.pseudo-element,.token.selector,.token.unit{color:#e9ae7e}.token.deleted,.token.important{color:#cd6660}.token.keyword-this,.token.this{color:#6cb8e6}.token.bold,.token.important,.token.keyword-this,.token.this{font-weight:700}.token.delimiter.important{font-weight:inherit}.token.italic{font-style:italic}.token.entity{cursor:help}.language-markdown .token.title,.language-markdown .token.title .token.punctuation{color:#6cb8e6;font-weight:700}.language-markdown .token.blockquote.punctuation{color:#f4adf4}.language-markdown .token.code{color:#6cc}.language-markdown .token.hr.punctuation{color:#6cb8e6}.language-markdown .token.url .token.content{color:#91d076}.language-markdown .token.url-link{color:#e6d37a}.language-markdown .token.list.punctuation{color:#f4adf4}.language-json .token.operator,.language-markdown .token.table-header{color:#e3eaf2}.language-scss .token.variable{color:#6cc}.token.cr:before,.token.lf:before,.token.space:before,.token.tab:not(:empty):before{color:#8da1b9}div.code-toolbar>.toolbar a,div.code-toolbar>.toolbar button{color:#111b27;background:#6cb8e6}div.code-toolbar>.toolbar a:focus,div.code-toolbar>.toolbar a:hover,div.code-toolbar>.toolbar button:focus,div.code-toolbar>.toolbar button:hover{color:#111b27;background:rgba(108,184,230,.8549019607843137);text-decoration:none}div.code-toolbar>.toolbar span,div.code-toolbar>.toolbar span:focus,div.code-toolbar>.toolbar span:hover{color:#111b27;background:#8da1b9}.line-highlight{background:rgba(60,82,109,.37254901960784315);background:linear-gradient(90deg,rgba(60,82,109,.37254901960784315) 70%,rgba(60,82,109,.3333333333333333))}.line-highlight:before,.line-highlight[data-end]:after{background-color:#8da1b9;color:#111b27;box-shadow:0 1px #3c526d}pre[id].linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:rgba(141,161,185,.09411764705882353)}.line-numbers .line-numbers-rows{border-right:1px solid #0b121b;background:rgba(11,18,27,.47843137254901963)}.line-numbers-rows>span:before{color:rgba(141,161,185,.8549019607843137)}.rainbow-braces .token.punctuation.brace-level-1,.rainbow-braces .token.punctuation.brace-level-5,.rainbow-braces .token.punctuation.brace-level-9{color:#e6d37a}.rainbow-braces .token.punctuation.brace-level-2,.rainbow-braces .token.punctuation.brace-level-6,.rainbow-braces .token.punctuation.brace-level-10{color:#f4adf4}.rainbow-braces .token.punctuation.brace-level-3,.rainbow-braces .token.punctuation.brace-level-7,.rainbow-braces .token.punctuation.brace-level-11{color:#6cb8e6}.rainbow-braces .token.punctuation.brace-level-4,.rainbow-braces .token.punctuation.brace-level-8,.rainbow-braces .token.punctuation.brace-level-12{color:#c699e3}pre.diff-highlight>code .token.deleted:not(.prefix),pre>code.diff-highlight .token.deleted:not(.prefix){background-color:rgba(205,102,96,.12156862745098039)}pre.diff-highlight>code .token.inserted:not(.prefix),pre>code.diff-highlight .token.inserted:not(.prefix){background-color:rgba(145,208,118,.12156862745098039)}.command-line-prompt{border-right:1px solid #0b121b}.command-line-prompt>span:before{color:rgba(141,161,185,.8549019607843137)}</style><meta name="generator" content="Gatsby 3.0.1"/><style data-styled="" data-styled-version="5.2.1">.dWGLst{margin-left:auto;margin-right:auto;max-width:1300px;padding-left:var(--size-700);padding-right:var(--size-700);height:100%;}/*!sc*/
@media screen and (max-width:1000px){.dWGLst{padding-left:var(--size-400);padding-right:var(--size-400);}}/*!sc*/
data-styled.g1[id="container__Container-g6pcgm-0"]{content:"dWGLst,"}/*!sc*/
.hUaVNz{padding-top:var(--size-300);}/*!sc*/
data-styled.g2[id="header__StyledHeader-sc-1344zpp-0"]{content:"hUaVNz,"}/*!sc*/
.kTLBWK{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g3[id="header__HeaderWrapper-sc-1344zpp-1"]{content:"kTLBWK,"}/*!sc*/
.ljBqLG a{text-transform:uppercase;-webkit-text-decoration:none;text-decoration:none;font-size:var(--size-400);color:inherit;}/*!sc*/
data-styled.g4[id="header__HeaderTitle-sc-1344zpp-2"]{content:"ljBqLG,"}/*!sc*/
.gMMtgi{position:static;padding:0;background:transparent;-webkit-backdrop-filter:unset;backdrop-filter:unset;}/*!sc*/
data-styled.g5[id="header__StyledNav-sc-1344zpp-3"]{content:"gMMtgi,"}/*!sc*/
.lcjsVP{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:space-around;-webkit-justify-content:space-around;-ms-flex-pack:space-around;justify-content:space-around;padding:0;list-style-type:none;}/*!sc*/
data-styled.g6[id="header__StyledNavList-sc-1344zpp-4"]{content:"lcjsVP,"}/*!sc*/
.estiEP:not(:last-of-type){margin-right:2rem;}/*!sc*/
@media screen and (max-width:700px){.estiEP:not(:last-of-type){margin-right:1rem;}}/*!sc*/
.estiEP a{color:inherit;text-transform:uppercase;font-size:var(--size-300);-webkit-text-decoration:none;text-decoration:none;-webkit-letter-spacing:0.1rem;-moz-letter-spacing:0.1rem;-ms-letter-spacing:0.1rem;letter-spacing:0.1rem;}/*!sc*/
@media screen and (max-width:700px){.estiEP a{font-size:0.7rem;}}/*!sc*/
data-styled.g7[id="header__StyledNavListItem-sc-1344zpp-5"]{content:"estiEP,"}/*!sc*/
.elPAeh{padding:0;list-style:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
data-styled.g8[id="social-links__SocialLinkList-r9vd8i-0"]{content:"elPAeh,"}/*!sc*/
.PkigP{margin-right:var(--size-400);text-transform:uppercase;}/*!sc*/
.PkigP a{color:inherit;font-size:var(--size-300);}/*!sc*/
data-styled.g9[id="social-links__SocialLinkItem-r9vd8i-1"]{content:"PkigP,"}/*!sc*/
.bXLsAg{padding-top:var(--size-300);padding-bottom:var(--size-300);}/*!sc*/
data-styled.g10[id="footer__StyledFooter-sc-1d6x338-0"]{content:"bXLsAg,"}/*!sc*/
.kzqyOn{font-size:var(--size-300);}/*!sc*/
.kzqyOn a{color:inherit;}/*!sc*/
data-styled.g11[id="footer__FooterAttribution-sc-1d6x338-1"]{content:"kzqyOn,"}/*!sc*/
.iWYEYe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g12[id="footer__FooterWrapper-sc-1d6x338-2"]{content:"iWYEYe,"}/*!sc*/
*,*::before,*::after{box-sizing:border-box;}/*!sc*/
body,h1,h2,h3,h4,p,figure,blockquote,dl,dd{margin:0;}/*!sc*/
ul[role='list'],ol[role='list']{list-style:none;}/*!sc*/
html:focus-within{-webkit-scroll-behavior:smooth;-moz-scroll-behavior:smooth;-ms-scroll-behavior:smooth;scroll-behavior:smooth;}/*!sc*/
html{height:-webkit-fill-available;}/*!sc*/
body{min-height:100vh;min-height:-webkit-fill-available;text-rendering:optimizeSpeed;line-height:1.5;}/*!sc*/
a:not([class]){-webkit-text-decoration-skip-ink:auto;text-decoration-skip-ink:auto;}/*!sc*/
img,picture{max-width:100%;display:block;}/*!sc*/
input,button,textarea,select{font:inherit;}/*!sc*/
@media (prefers-reduced-motion:reduce){html:focus-within{-webkit-scroll-behavior:auto;-moz-scroll-behavior:auto;-ms-scroll-behavior:auto;scroll-behavior:auto;}*,*::before,*::after{-webkit-animation-duration:0.01ms !important;animation-duration:0.01ms !important;-webkit-animation-iteration-count:1 !important;animation-iteration-count:1 !important;-webkit-transition-duration:0.01ms !important;transition-duration:0.01ms !important;-webkit-scroll-behavior:auto !important;-moz-scroll-behavior:auto !important;-ms-scroll-behavior:auto !important;scroll-behavior:auto !important;}}/*!sc*/
html{width:100vw;overflow-x:hidden;}/*!sc*/
body::-webkit-scrollbar{width:10px;}/*!sc*/
body::-webkit-scrollbar-thumb{background-color:rgba(55,41,44,.4);}/*!sc*/
body::-webkit-scrollbar-track{background:#aaa;}/*!sc*/
:root{--size-300:0.75rem;--size-400:1rem;--size-500:1.33rem;--size-600:1.77rem;--size-700:2.36rem;--size-800:3.15rem;--size-900:4.2rem;}/*!sc*/
body{font-family:'Poppins',-apple-system,BlinkMacSystemFont,avenir next,avenir,helvetica neue, helvetica,Ubuntu,roboto,noto,segoe ui,arial,sans-serif;color:#37292C;background-attachment:fixed;background-color:#d9e4f5;background-image:linear-gradient(315deg,#d9e4f5 0%,#f5e3e6 74%);}/*!sc*/
h1,h2,h3,h4{line-height:1.125;}/*!sc*/
h1,h2,h3{font-weight:700;}/*!sc*/
h1{font-size:var(--size-800);}/*!sc*/
h2{font-size:var(--size-700);}/*!sc*/
h3{font-size:var(--size-600);}/*!sc*/
p{font-size:var(--size-400);}/*!sc*/
::selection{background:rgba(255,255,255,0.9);}/*!sc*/
p,li{max-width:none;}/*!sc*/
.gatsby-resp-image-wrapper{margin-left:0 !important;}/*!sc*/
data-styled.g13[id="sc-global-dqoMdz1"]{content:"sc-global-dqoMdz1,"}/*!sc*/
.cKBEjL{min-height:100vh;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}/*!sc*/
.cKBEjL main{margin-top:auto;margin-bottom:auto;}/*!sc*/
.cKBEjL footer{margin-top:auto;}/*!sc*/
data-styled.g14[id="layout__LayoutWrapper-qrswv8-0"]{content:"cKBEjL,"}/*!sc*/
.gGPpxa{margin-right:0.6rem;margin-bottom:0.6rem;text-transform:uppercase;font-size:var(--size-300);}/*!sc*/
.gGPpxa a{position:relative;z-index:2;background-color:rgba(255,255,255,0.7);-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:0.2rem 0.6rem;border:1px solid rgba(255,255,255,1);border-radius:4px;}/*!sc*/
.gGPpxa a:hover{background-color:rgba(255,255,255,0.9);}/*!sc*/
data-styled.g16[id="tags__Tag-sc-16itk8x-0"]{content:"gGPpxa,"}/*!sc*/
.jLVknC{padding-top:var(--size-900);padding-bottom:var(--size-900);margin-left:auto;margin-right:auto;max-width:70ch;word-wrap:break-word;}/*!sc*/
data-styled.g39[id="post-template__PostWrapper-afk1br-0"]{content:"jLVknC,"}/*!sc*/
.jvERbU{font-size:var(--size-700);}/*!sc*/
data-styled.g40[id="post-template__PostTitle-afk1br-1"]{content:"jvERbU,"}/*!sc*/
.ijlCjX{font-size:var(--size-400);padding-top:1rem;text-transform:uppercase;}/*!sc*/
data-styled.g41[id="post-template__PostDate-afk1br-2"]{content:"ijlCjX,"}/*!sc*/
.dEfyJD{padding-top:var(--size-800);}/*!sc*/
.dEfyJD > * + *{margin-top:var(--size-300);}/*!sc*/
.dEfyJD > p + p{margin-top:var(--size-700);}/*!sc*/
.dEfyJD * + h1,.dEfyJD * + h2,.dEfyJD * + h3{margin-top:var(--size-900);}/*!sc*/
.dEfyJD h1{font-size:var(--size-700);}/*!sc*/
.dEfyJD h2{font-size:var(--size-600);}/*!sc*/
.dEfyJD h3{font-size:var(--size-500);}/*!sc*/
.dEfyJD b,.dEfyJD strong{font-weight:600;}/*!sc*/
.dEfyJD a{color:inherit;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration-thickness:0.125rem;text-decoration-thickness:0.125rem;}/*!sc*/
.dEfyJD blockquote{padding-left:var(--size-400);border-left:5px solid;font-style:italic;}/*!sc*/
.dEfyJD code{font-family:"Source Sans Pro",monospace;overflow-x:auto;white-space:pre-wrap;}/*!sc*/
.dEfyJD pre{overflow-x:auto;white-space:pre-wrap;max-width:100%;}/*!sc*/
data-styled.g42[id="post-template__PostContent-afk1br-3"]{content:"dEfyJD,"}/*!sc*/
.ijTjwt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:var(--size-900);}/*!sc*/
.ijTjwt > *{position:relative;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:1rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:8px;border:1px solid rgba(255,255,255,0.5);background-color:rgba(255,255,255,0.3);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);margin:0.5rem;}/*!sc*/
.ijTjwt > *:hover{background-color:rgba(255,255,255,0.5);}/*!sc*/
.ijTjwt span{text-transform:uppercase;opacity:0.6;font-size:var(--size-400);padding-bottom:var(--size-500);}/*!sc*/
.ijTjwt a{color:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:var(--size-400);text-transform:capitalize;}/*!sc*/
.ijTjwt a::after{content:"";position:absolute;left:0;right:0;top:0;bottom:0;}/*!sc*/
data-styled.g43[id="post-template__PostPagination-afk1br-4"]{content:"ijTjwt,"}/*!sc*/
</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{all:inherit;bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro|Poppins:400,400i,700&amp;display=swap" rel="stylesheet"/><link rel="icon" href="/favicon-32x32.png?v=a9c34c9cfad998e9d71d69da79e233c6" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a9c34c9cfad998e9d71d69da79e233c6"/><title>A Dive into Fluidex&#x27;s Architecture - Fluidex</title><meta name="description" content="Building the first fully open-source zk-rollup orderbook DEX in the world."/><meta property="og:title" content="A Dive into Fluidex&#x27;s Architecture"/><meta property="og:description" content="Building the first fully open-source zk-rollup orderbook DEX in the world."/><meta property="og:type" content="website"/><meta property="og:image" content="https://raw.githubusercontent.com/Fluidex/fluidex.github.io/master/static/media/square.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="fluid_dex"/><meta name="twitter:title" content="A Dive into Fluidex&#x27;s Architecture"/><meta name="twitter:description" content="Building the first fully open-source zk-rollup orderbook DEX in the world."/><meta name="twitter:image" content="https://raw.githubusercontent.com/Fluidex/fluidex.github.io/master/static/media/wide.png"/><link as="script" rel="preload" href="/webpack-runtime-a6a05c14793d7c0627b7.js"/><link as="script" rel="preload" href="/framework-6eebe74f6e3ca2e4baa9.js"/><link as="script" rel="preload" href="/app-9a0505fc912e198efe6f.js"/><link as="script" rel="preload" href="/commons-5ee680bf8998dc89a339.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-a76bda2642029ae4f2bc.js"/><link as="fetch" rel="preload" href="/page-data/en/blog/fluidex-architecture/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2555585279.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3159585216.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__LayoutWrapper-qrswv8-0 cKBEjL"><header class="header__StyledHeader-sc-1344zpp-0 hUaVNz"><div class="container__Container-g6pcgm-0 header__HeaderWrapper-sc-1344zpp-1 dWGLst kTLBWK"><div class="header__HeaderTitle-sc-1344zpp-2 ljBqLG"><a href="/en/index">Fluidex</a></div><nav class="header__StyledNav-sc-1344zpp-3 gMMtgi"><ul class="header__StyledNavList-sc-1344zpp-4 lcjsVP"><li class="header__StyledNavListItem-sc-1344zpp-5 estiEP"><a href="/en/blog">Blog</a></li><li class="header__StyledNavListItem-sc-1344zpp-5 estiEP"><a href="/en/about">About</a></li><li class="header__StyledNavListItem-sc-1344zpp-5 estiEP"><a href="/en/contact">Contact</a></li><li class="header__StyledNavListItem-sc-1344zpp-5 estiEP"><style data-emotion="css 2b097c-container">.css-2b097c-container{position:relative;box-sizing:border-box;}</style><div class=" css-2b097c-container"><style data-emotion="css 7pg0cj-a11yText">.css-7pg0cj-a11yText{z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap;}</style><span aria-live="polite" aria-atomic="false" aria-relevant="additions text" class="css-7pg0cj-a11yText"></span><style data-emotion="css ib73kg-control">.css-ib73kg-control{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:hsl(0, 0%, 100%);border-color:hsl(0, 0%, 80%);border-radius:4px;border-style:solid;border-width:1px;cursor:default;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;min-height:38px;outline:0!important;position:relative;-webkit-transition:all 100ms;transition:all 100ms;box-sizing:border-box;height:35px;width:150px;}.css-ib73kg-control:hover{border-color:hsl(0, 0%, 70%);}</style><div class=" css-ib73kg-control"><style data-emotion="css 1hwfws3">.css-1hwfws3{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:2px 8px;-webkit-overflow-scrolling:touch;position:relative;overflow:hidden;box-sizing:border-box;}</style><div class=" css-1hwfws3"><style data-emotion="css 1uccc91-singleValue">.css-1uccc91-singleValue{color:hsl(0, 0%, 20%);margin-left:2px;margin-right:2px;max-width:calc(100% - 8px);overflow:hidden;position:absolute;text-overflow:ellipsis;white-space:nowrap;top:50%;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);box-sizing:border-box;}</style><div class=" css-1uccc91-singleValue"><div style="display:flex">English</div></div><style data-emotion="css 1g6gooi">.css-1g6gooi{margin:2px;padding-bottom:2px;padding-top:2px;visibility:visible;color:hsl(0, 0%, 20%);box-sizing:border-box;}</style><div class="css-1g6gooi"><div class="" style="display:inline-block"><input type="text" autoCapitalize="none" autoComplete="off" autoCorrect="off" id="react-select-4-input" spellcheck="false" tabindex="0" value="" aria-autocomplete="list" style="box-sizing:content-box;width:1px;label:input;background:0;border:0;font-size:inherit;opacity:1;outline:0;padding:0;color:inherit"/><div style="position:absolute;top:0;left:0;visibility:hidden;height:0;overflow:scroll;white-space:pre"></div></div></div></div><style data-emotion="css 1wy0on6">.css-1wy0on6{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-align-self:stretch;-ms-flex-item-align:stretch;align-self:stretch;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;}</style><div class=" css-1wy0on6"><style data-emotion="css 1okebmr-indicatorSeparator">.css-1okebmr-indicatorSeparator{-webkit-align-self:stretch;-ms-flex-item-align:stretch;align-self:stretch;background-color:hsl(0, 0%, 80%);margin-bottom:8px;margin-top:8px;width:1px;box-sizing:border-box;}</style><span class=" css-1okebmr-indicatorSeparator"></span><style data-emotion="css tlfecz-indicatorContainer">.css-tlfecz-indicatorContainer{color:hsl(0, 0%, 80%);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:8px;-webkit-transition:color 150ms;transition:color 150ms;box-sizing:border-box;}.css-tlfecz-indicatorContainer:hover{color:hsl(0, 0%, 60%);}</style><div class=" css-tlfecz-indicatorContainer" aria-hidden="true"><style data-emotion="css 8mmkcg">.css-8mmkcg{display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0;}</style><svg height="20" width="20" viewBox="0 0 20 20" aria-hidden="true" focusable="false" class="css-8mmkcg"><path d="M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"></path></svg></div></div></div></div></li></ul></nav></div></header><main><div class="container__Container-g6pcgm-0 dWGLst"><div class="post-template__PostWrapper-afk1br-0 jLVknC"><article><h1 class="post-template__PostTitle-afk1br-1 jvERbU">A Dive into Fluidex&#x27;s Architecture</h1><span class="post-template__PostDate-afk1br-2 ijlCjX">July 15, 2021</span><section class="post-template__PostContent-afk1br-3 dEfyJD"><blockquote>
<p>The cryptography underlying zero knowledge proofs has undergone a Moore’s Law-like trajectory over the last few years, and it shows no sign of slowing down.</p>
<p>— <a href="https://medium.com/dragonfly-research/im-worried-nobody-will-care-about-rollups-554bc743d4f1">Dragonfly Research</a></p>
</blockquote>
<p>ZK-Rollup, with its terrific security and decentralization properties, is believed as the most important Layer 2 scaling solution in the long term. However, the nice features of ZK-Rollup come with a cost of technical difficulties, in terms of both cryptography and engineering. No wonder why there are only a few relevant devtools or user-end products out there. As one of the a few teams that are developing a ZK-Rollup system from scratch instead of forking, <a href="https://github.com/Fluidex">Fluidex</a> decides to share some of our experience and outcomes with the industry, to help explode the ZK-Rollup ecosystem.</p>
<p>Before moving on, we recommend our readers to check out the article <a href="/en/blog/zkrollup-intro1/">“ZK-Rollup development experience sharing, Part I”</a>, in which we talk about how to develop and optimize a ZK-Rollup. As the second part of this “development experience-sharing” series, this article focuses on our <a href="https://github.com/Fluidex/fluidex-backend">recently open-sourced back-end architecture</a>, aiming at guiding more developers into the ZK-Rollup ecosystem.</p>
<h2>Overall Architecture</h2>
<p>The diagram below shows the overall architecture of Fluidex’s back-end. In a nutshell, users send order requests to the matching engine, and the matching engine sends all the finished orders to the message queue. The rollup module then updates the states (users’ orders, users’ balances…) on the Merkle tree and packs the messages (after some format conversions) into L2 blocks. After L2 blocks being proved by our prover cluster, they will be published onto chain.</p>
<p align="center">
  <img src="/08029b15199d30179156deadc002f90b/Fluidex Architecture.svg" width="600">
</p>
<p>We will now first introduce the functionalities and responsibilities of each submodule, and then summarize the design principles of our system.</p>
<h2>Submodules</h2>
<h3>Gateway</h3>
<p>Gateway is to accept order requests from front-end or quant trading bots, and to route them into different micro-services. Gateway will also push the up-to-date internal market k-line and orderbook information to the ticker subscribers<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> in a desired format. Given the excellent performance and configuration flexibility, we choose Envoy for our gateway. Besides, note that Fluidex uses GRPC extensively including both unary RPC and bidirectional streaming RPC, Envoy’s excellent support for GRPC can fulfill our requirements.</p>
<h3>Matching Engine</h3>
<p><a href="https://github.com/Fluidex/dingir-exchange">dingir exchange</a> is a high-performance exchange matching engine. It stores and matches user orders in RAM in real time. We use BTreeMap<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> for our orderbook, because it requires both key-value query (for order details) and in-order traversal (for order matching), which means that it needs an ordered associative array like AVL tree / skip list. Moreover, BTreeMap can benefit from modern CPUs’ cache architecture.</p>
<p>The persistence of the global state is achieved by periodical dumps and operation logs. By periodical <a href="https://en.wikipedia.org/wiki/Fork_(system_call)">process forks</a>, which has lower latency than “stop-world” and than “deep-copy”, the new child process persists the global state. In addition, all user requests are persisted into the database in batches (otherwise leading to heavy database pressure) as operation logs. The combination of the two persistence mechanisms ensures that if the system suddenly goes down, the system state can be quickly recovered.</p>
<p>High, low, open, close and volume are queried from TimescaleDB, a time series database, to generate K-line.</p>
<h3>Rollup State Manager</h3>
<p>In a ZK-Rollup system, the smart contract only needs to store the Merkle root of the global state instead of the entire Merkle tree of all the states. The maintenance of the Merkle tree is done by the off-chain rollup state manager. Rollup state manager receives finished orders and other operations (e.g., withdrawal, transfer…) from the message queue and update the Merkle tree. Operations are packed into L2 Blocks.</p>
<p>Rollup will periodically dump checkpoints (with message queue offsets). When the system restarts, it will load the state of Merkle tree from the last checkpoint, seek the corresponding offset in the message queue, and reprocess the messages in the message queue to recover the latest state.</p>
<h3>Prover Cluster</h3>
<p>After a L2 block is generated by the rollup state manager, a cryptographic proof is needed so that this block can be verified as correct on chain. This requires a prover cluster to provide desired computing power. What’s more, since the transaction volume of a DEX may vary considerably in different periods of time, this proof cluster needs to be highly scalable and elastic.</p>
<p>To meet these requirements, we adopt the Master-Worker architecture, which consists of a stateful master node that manages a list of proving tasks, and a couple of stateless worker nodes that retrieve tasks from the master and submit proofs to the master after proving. Similar to PoW mining, since the computation for ZK-Rollup verification is much more lightweight than that of proving, we consider switching to a more “trustless” architecture in the future, so that miners can join and quit proving permissionlessly at any time. The cryptography behind can ensure that if a proof is validated (which can be checked quickly), the miner is not misbehaving.</p>
<p>At present, prover cluster provides two different deployment styles - via Docker Compose and via K8S - to support local development/debugging and production environment deployment.</p>
<h2>The Design Principles of Fluidex Back-end</h2>
<h3>CQRS and Global Message Bus</h3>
<p>The status update of a rollup system requires extremely strict consistency and accuracy – not even a slightest error is allowed. All status update operations should be traceable and recorded. To provide such reliable status updates, we adopt the <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/cqrs">CQRS</a> design pattern. <strong>All writes to the global state are synchronized by a message queue.</strong> Specifically, we use Kafka as the global message bus. The rollup system uses the message queue for the ground truth, receives notifications for status updates from the message queue, and update the global Merkle tree accordingly.</p>
<h3>Memory-centric Data Maintenance</h3>
<p>Conventional Internet services use databases for their data ground truths. They usually achieve their systems’ scalability and resilience through data sharding and stateless services.</p>
<p>However, our ZK-Rollup system consists of many services that have to maintain a large number of complex data structures in memory (such as the rollup and the matching engine that maintains the Merkle tree and orderbook respectively). This requires an memory-centric architecture design. As a result, our design principles may differ from the <a href="https://12factor.net/">12 Factor</a> recommended in many Internet business, but are more similar to game server developments.</p>
<h3>Unified Technology Stack</h3>
<p>Thanks to Rust’s type safety and ownership checks, as well as the performance comparable with C++, Rust has become the first choice for many cryptographic libraries, and the ecosystem has been exploding. Therefore, it is not surprising that we choose Rust for our rollup state manager and prover cluster. Besides, since a unified technology stack can greatly reduce our team’s cooperation overhead, other modules are also implemented in Rust.</p>
<h2>Source Codes</h2>
<p>Fluidex-backend has been open-sourced on Github and please refer to <a href="https://github.com/Fluidex/fluidex-backend">https://github.com/Fluidex/fluidex-backend</a>. (Currently only with instructions on how to run it as a local cluster.) </p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>using “grpc->websocket” but not implemented yet.</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
<li id="fn-2">
<p><a href="https://doc.rust-lang.org/stable/std/collections/struct.BTreeMap.html">https://doc.rust-lang.org/stable/std/collections/struct.BTreeMap.html</a></p>
<a href="#fnref-2" class="footnote-backref">↩</a>
</li>
</ol>
</div></section></article><nav class="post-template__PostPagination-afk1br-4 ijTjwt"><div><span>next</span><a href="/en/blog/on-plonk/"> <!-- -->On the optimization of PlonK</a></div></nav><div><span class="tags__Tag-sc-16itk8x-0 gGPpxa"><a href="/en/tags/technical">technical</a></span></div></div></div></main><footer class="footer__StyledFooter-sc-1d6x338-0 bXLsAg"><div class="container__Container-g6pcgm-0 footer__FooterWrapper-sc-1d6x338-2 dWGLst iWYEYe"><ul class="social-links__SocialLinkList-r9vd8i-0 elPAeh"><li class="social-links__SocialLinkItem-r9vd8i-1 PkigP"><a href="https://github.com/Fluidex">github</a></li><li class="social-links__SocialLinkItem-r9vd8i-1 PkigP"><a href="https://t.me/fluid_dex">telegram</a></li><li class="social-links__SocialLinkItem-r9vd8i-1 PkigP"><a href="https://twitter.com/fluid_dex">twitter</a></li><li class="social-links__SocialLinkItem-r9vd8i-1 PkigP"><a href="https://fluid-dex.medium.com/">medium</a></li></ul><p class="footer__FooterAttribution-sc-1d6x338-1 kzqyOn">Copyright © 2021 Team Fluidex. All rights reserved.</p></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/en/blog/fluidex-architecture/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-09f2335fbd5439b3b0a4.js"],"app":["/app-9a0505fc912e198efe6f.js"],"component---src-pages-404-index-en-js":["/component---src-pages-404-index-en-js-16ceaae0911b41f14c1e.js"],"component---src-pages-404-index-zh-js":["/component---src-pages-404-index-zh-js-7e6361be422b66748607.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a7e3873d2c07695ebe7f.js"],"component---src-pages-blog-index-en-js":["/component---src-pages-blog-index-en-js-be6f5fc752e3f7126a8b.js"],"component---src-pages-blog-index-zh-js":["/component---src-pages-blog-index-zh-js-ac32559f6f328ee936d9.js"],"component---src-pages-tags-index-en-js":["/component---src-pages-tags-index-en-js-18bf4f8b00e73baaa355.js"],"component---src-pages-tags-index-zh-js":["/component---src-pages-tags-index-zh-js-1c258a3d7652941f954d.js"],"component---src-templates-about-template-js":["/component---src-templates-about-template-js-ab4b7e3b7c1c79e0b1ad.js"],"component---src-templates-contact-template-js":["/component---src-templates-contact-template-js-e8fbc5656f02270afd1c.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-c767791e3b32c1b5c9d6.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-a76bda2642029ae4f2bc.js"],"component---src-templates-tags-template-js":["/component---src-templates-tags-template-js-590a4932fac61ecedc83.js"]};/*]]>*/</script><script src="/polyfill-09f2335fbd5439b3b0a4.js" nomodule=""></script><script src="/component---src-templates-post-template-js-a76bda2642029ae4f2bc.js" async=""></script><script src="/commons-5ee680bf8998dc89a339.js" async=""></script><script src="/app-9a0505fc912e198efe6f.js" async=""></script><script src="/framework-6eebe74f6e3ca2e4baa9.js" async=""></script><script src="/webpack-runtime-a6a05c14793d7c0627b7.js" async=""></script></body></html>